#
# Build configuration for Circle CI
#

general:
    artifacts:
        - /home/ubuntu/${CIRCLE_PROJECT_REPONAME}/app/build/outputs/apk/

machine:
    environment:
        ANDROID_HOME: /usr/local/android-sdk-linux

dependencies:
    override:
       - source tools/environmentSetup.sh && getAndroidSDK

test:
  pre:
        # start the emulator
      - emulator -avd circleci-android22 -no-audio -no-window:
          background: true
          parallel: true
        # wait for it to have booted
      - circle-android wait-for-boot
  override:
    - ./gradlew test
    - ./gradlew jacocoTestReport
    - ./gradlew assembleDebug pmd findbugs
    - cp -r /home/ubuntu/weatherapp/app/build/reports/tests $CIRCLE_ARTIFACTS
    - cp -r /home/ubuntu/weatherapp/app/build/outputs $CIRCLE_ARTIFACTS
    - sudo apt-get install dc
    - chmod +x tools/checkCoverageGoal.sh
    - source tools/checkCoverageGoal.sh
  post:
    - bash <(curl -s https://codecov.io/bash)

deployment:
    development:
    branch: dev
    commands:
      - source tools/deployHockeyApp.sh && uploadToHockeyAppDevelopment
#
#deployment:
#    release:
#    branch: master
#    commands:
#      - source tools/deployHockeyApp.sh && uploadToHockeyRelease